# 关于数据损坏的一些记录

更新于 2018 年 9 月 2 日

[TOC]

## 背景
- 昨天，当我在用自己在移动硬盘上的主力虚拟机的时候，突然虚拟机进程卡住。然后我
  结束了虚拟机的进程，发现vmx和vmdk文件损坏。
- 然后以为是幻觉，遂拔除了移动硬盘再重新插上，发现不但不是幻觉，问题更加严重，
  移动硬盘上的四个卷的内容全部错乱。
- 按理来说，如果是上大学前的我遇到这个问题的话应该非常急躁，但是貌似自从上大学
  后的我不小心把书包落在了食堂后的那天发现自己失去了急躁的能力。所以我冷静的用
  管理员权限运行命令提示符，使用系统自带的 chkdsk 修复，修复非常成功，但也大概
  丢掉了 80 GiB 左右的数据。

## 损失
- 整个主力虚拟机（65 GiB 左右），心疼的还是 QQ 聊天记录。
- 笔记本的系统盘 wim 镜像备份 (20 GiB 左右)。
- 虚拟机卷里几个曾经用的虚拟机。
- 虚拟机卷的绝大部分虚拟机的配置文件。

## 心得
- 大文件丢失后大概率无法恢复。
- 小文件由于存放在 MFT 中，于是一旦 MFT 受损就会灰飞烟灭。
- 整个文件夹也许文件系统下也是一个文件。
- 幸好我有多块移动硬盘分别存放不同的数据，如果所有数据都放在这块盘上，损失应该
  更大。想起了几年前只有一块移动硬盘的自己手贱在移动硬盘写了 Windows PE 引导然
  后花了一天恢复 300 GiB 左右大小数据的经历。

## 对策
- 按照实验室的一个学长（由于这是公开页面且我没有征得其同意的情况下是不可能泄露
  他的名字的，请谅解）的建议，我也许会尝试使用 OneDrive 这样的云存储。毕竟我和
  那位学长一样都是有 1 TiB OneDrive 的正版 Office 365 用户。
- 虚拟机的话，由于无法恢复，所以只能重新创建新的主力虚拟机了。但是我应该会使用
  分割多个文件且固定大小的虚拟磁盘，这样能保证性能，而且一旦出现数据丢失也许还
  能抢救一些内容。
- 一些重要的备份和不能公开的存档将会放在另一块 2 TB 大小的存档盘中。
- 一些可以公开的资料将会推到本站或者其他属于我的代码仓库中。

## 后记（2018 年 9 月 2 日）
- 原文写于 2018 年 8 月 15 日。
- 没过几天又出现了一次数据丢失的情况，我才发现问题也许是因为使用 DISM 把我笔记
  本的系统备份镜像保存到我往最后 100GB 大小的分区的缘故。我用 DiskGenius 和 
  Victoria 检查了下那个分区对应的扇区发现有很多有缺陷的磁盘块，于是我不再使用那
  段空间，到现在坚持了大概有半个月，暂时没有任何问题。
- 当然由于不能把系统备份镜像再保存到那个分区，于是我打算把系统备份镜像保存到我
  最近购买的 2TB 大小的存档盘，但我又害怕对存档盘误操作。于是我尝试直接在系统
  分区保存系统备份镜像，发现竟然可行。于是重启后我把系统备份镜像从系统盘移动到
  了存档盘。这也是我学到的新技巧。
